<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audit - NBFO CoopÃ©rative</title>
  <style>
    body { font-family:sans-serif; background:#f5f5f5; margin:0; }
    .header { background:#607d8b; color:white; padding:20px; display:flex; justify-content:space-between; }
    .btn-logout { background:#e53935; border:none; padding:10px 20px; border-radius:8px; color:white; cursor:pointer; }
    .container { max-width:1200px; margin:0 auto; padding:20px; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:10px; border-bottom:1px solid #ccc; }
    .alert { display:none; margin:15px 0; padding:12px; border-radius:8px; }
    .alert-error { background:#ffebee; border:1px solid #ef5350; color:#c62828; }
  </style>
</head>
<body>
  <div class="header">
    <div>ðŸ“‹ Audit</div>
    <button class="btn-logout" onclick="logout()">DÃ©connexion</button>
  </div>
  <div class="container">
    <div id="alertBox" class="alert alert-error"></div>
    <h2>Historique des actions</h2>
    <div id="auditContainer">Chargement...</div>
  </div>
<script scr = "/js/auth.js></script>  
<script>   
  // Ce code reste tel quel - il ne touche PAS aux mots de passe
  function getCurrentUser() {
  const userInfo = sessionStorage.getItem("userInfo");
  return userInfo ? JSON.parse(userInfo) : null;
}

function requireLogin() {
  const user = getCurrentUser();
  if (!user || !user.username || !user.role) {
    sessionStorage.clear();
    window.location.href = "/index.html";
    return null;
  }
  return user;
}

function loadRoleContent(role) {
  // ... votre code actuel
}
</script>
  <script defer>
    const alertBox=document.getElementById('alertBox');
    const auditContainer=document.getElementById('auditContainer');
    let currentUser=null;

    function showError(msg){alertBox.textContent=msg;alertBox.style.display='block';}

    try{
      const userInfo=sessionStorage.getItem('userInfo');
      if(!userInfo) window.location.href='/index.html';
      currentUser=JSON.parse(userInfo);
      if(currentUser.role!=='admin'){
        showError('AccÃ¨s refusÃ© : rÃ©servÃ© aux administrateurs');
        setTimeout(()=>window.location.href='/dashboard.html',2000);
      }
    }catch(err){
      showError('Session invalide, reconnectez-vous.');
      setTimeout(()=>window.location.href='/index.html',2000);
    }

    async function loadAudit(){
      try{
        const res=await fetch('/audit');
        if(!res.ok) throw new Error();
        const logs=await res.json();
        if(logs.length===0){auditContainer.textContent='Aucune activitÃ©';return;}
        auditContainer.innerHTML=`<table>
          <thead><tr><th>Date</th><th>Utilisateur</th><th>Action</th></tr></thead>
          <tbody>${logs.map(l=>`
            <tr><td>${new Date(l.date).toLocaleString('fr-FR')}</td><td>${l.utilisateur}</td><td>${l.action}</td></tr>
          `).join('')}</tbody></table>`;
      }catch(err){
        auditContainer.textContent='Erreur de chargement';
      }
    }
    loadAudit();

    function logout(){sessionStorage.removeItem('userInfo');window.location.href='/index.html';}
  </script>
</body>
</html>
