<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Caisse - NBFO CoopÃ©rative</title>
  <style>
    body { font-family: sans-serif; background:#f5f5f5; margin:0; }
    .header { background:linear-gradient(135deg,#f57c00,#ff9800); color:white; padding:20px; display:flex; justify-content:space-between; align-items:center; }
    .logo { font-size:24px; }
    .btn-logout { background:#e53935; border:none; padding:10px 20px; border-radius:8px; color:white; cursor:pointer; }
    .container { max-width:1200px; margin:0 auto; padding:20px; }
    .alert { display:none; margin:15px 0; padding:12px; border-radius:8px; }
    .alert-error { background:#ffebee; border:1px solid #ef5350; color:#c62828; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">ðŸ’° Gestion de Caisse</div>
    <button class="btn-logout" onclick="logout()">DÃ©connexion</button>
  </div>
  <div class="container">
    <div id="alertBox" class="alert alert-error"></div>
    <h2>Solde actuel</h2>
    <p id="soldeValue">0</p>
    <h2>OpÃ©rations</h2>
    <div id="operationsContainer">Chargement...</div>
  </div>

  <script defer>
    const alertBox = document.getElementById('alertBox');
    const soldeValue = document.getElementById('soldeValue');
    const operationsContainer = document.getElementById('operationsContainer');
    let currentUser = null;

    function showError(msg) {
      alertBox.textContent = msg;
      alertBox.style.display = 'block';
    }

    // VÃ©rification session
    try {
      const userInfo = sessionStorage.getItem('userInfo');
      if (!userInfo) window.location.href = '/index.html';
      currentUser = JSON.parse(userInfo);
      if (!['caisse','admin'].includes(currentUser.role)) {
        showError('AccÃ¨s refusÃ© : rÃ´le non autorisÃ©');
        setTimeout(()=>window.location.href='/dashboard.html',2000);
      }
    } catch(err) {
      showError('Session invalide, reconnectez-vous.');
      setTimeout(()=>window.location.href='/index.html',2000);
    }

    async function loadOperations() {
      try {
        const res = await fetch('/operations');
        if (!res.ok) throw new Error();
        const ops = await res.json();
        if (ops.length===0) { operationsContainer.textContent='Aucune opÃ©ration'; return; }
        soldeValue.textContent = ops[0].solde_apres.toLocaleString('fr-FR');
        operationsContainer.innerHTML = ops.slice(0,10).map(op=>`
          <div>${new Date(op.date_operation).toLocaleString('fr-FR')} - ${op.type_operation} - ${op.montant}</div>
        `).join('');
      } catch(err) {
        operationsContainer.textContent='Erreur de chargement';
      }
    }
    loadOperations();

    function logout() {
      sessionStorage.removeItem('userInfo');
      window.location.href='/index.html';
    }
  </script>
</body>
</html>

